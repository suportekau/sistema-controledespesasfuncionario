<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sistema de Cadastro e Consulta</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0; padding: 0;
  background: #f0f0f0;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Abas */
.tabs {
  display: flex;
  background: #2196F3;
}
.tab {
  padding: 14px 20px;
  cursor: pointer;
  color: white;
  font-weight: bold;
  user-select: none;
  border-bottom: 3px solid transparent;
  transition: background 0.2s;
}
.tab:hover { background: #1e88e5; }
.tab.active {
  border-bottom: 3px solid #ffeb3b;
  background: #1976d2;
}
.tab-content {
  flex-grow: 1;
  padding: 20px;
  background: white;
  overflow-y: auto;
}
.tab-content:not(.active) { display: none; }

/* Título da aba */
.titulo-aba {
  font-size: 22px;
  font-weight: bold;
  color: #1976d2;
  margin-bottom: 15px;
  border-left: 6px solid #2196F3;
  padding-left: 10px;
}
.tab-content.active {
  background: #fafafa;
  border-top: 3px solid #2196F3;
  animation: fadeIn 0.3s ease-in;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Formulário */
form label {
  display: block;
  margin-top: 10px;
  font-weight: bold;
}
form input[type=text],
form input[type=date],
form input[type=time] {
  width: 100%;
  padding: 8px;
  box-sizing: border-box;
  font-size: 14px;
  text-transform: uppercase;
}
form input[type=time] { text-transform: none; }
form input[readonly] { background: #ddd; }

/* Tabela */
table { width: 100%; border-collapse: collapse; font-size: 14px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; vertical-align: middle; }
th { background: #1976d2; color: white; }
tr:nth-child(even) { background: #f9f9f9; }
td.actions { text-align: center; }
td.actions button { background: transparent; border: none; cursor: pointer; font-size: 16px; margin: 0 5px; }
td.actions button.edit { color: #2196f3; }
td.actions button.delete { color: #f44336; }

#filtroGeral { width: 250px; padding: 6px 8px; margin-right: 10px; text-transform: uppercase; }
#filtros { margin-bottom: 15px; display:flex; align-items:center; gap:10px; }

#btnSair { background:#f44336; color:white; padding:8px 14px; border:none; border-radius:4px; cursor:pointer; }
#btnInserirCadastro { background:#4caf50; color:white; padding:8px 14px; border:none; border-radius:4px; cursor:pointer; }
</style>
</head>
<body>

<!-- Abas -->
<div class="tabs">
  <div class="tab" data-tab="inserir">Inserir Dados</div>
  <div class="tab active" data-tab="consulta">Consulta</div>
</div>

<!-- Aba Inserir -->
<div id="inserir" class="tab-content">
  <div class="titulo-aba">Inserir Novo Registro</div>
  <form id="formCadastro">

    <div style="display:flex; align-items:flex-end; gap:10px;">
      <div style="flex:0 0 100px;">
        <label for="id">ID</label>
        <input type="text" id="id" readonly style="width:100%; text-align:center;" />
      </div>

      <div style="flex-grow:1; display:flex; justify-content:flex-end; gap:10px;">
        <button type="button" id="btnSalvar" 
          style="background:#4caf50; color:white; border:none; padding:8px 16px; border-radius:4px; font-weight:bold; cursor:pointer;">
          Salvar
        </button>
        <button type="button" id="btnCancelar" 
          style="background:#f44336; color:white; border:none; padding:8px 16px; border-radius:4px; font-weight:bold; cursor:pointer;">
          Cancelar
        </button>
      </div>
    </div>

    <label for="nome">Nome</label>
    <input type="text" id="nome" autocomplete="off" required />

    <label for="cargo">Cargo</label>
    <input type="text" id="cargo" autocomplete="off" />

    <label for="setor">Setor</label>
    <input type="text" id="setor" autocomplete="off" />

    <label for="horarioInicio">Horário Início</label>
    <input type="time" id="horarioInicio" />

    <label for="horarioFim">Horário Fim</label>
    <input type="time" id="horarioFim" />

    <label for="dataAdm">Data Admissão</label>
    <input type="date" id="dataAdm" />
  </form>
</div>

<!-- Aba Consulta -->
<div id="consulta" class="tab-content active">
  <div class="titulo-aba">Consulta de Registros</div>
  <div id="filtros">
    <input type="text" id="filtroGeral" placeholder="FILTRAR QUALQUER CAMPO..." />
    <button id="btnInserirCadastro">Inserir Cadastro</button>
    <button id="btnSair">Sair</button>
  </div>

  <table id="tabelaConsulta">
    <thead>
      <tr>
        <th>Id</th>
        <th>Nome</th>
        <th>Cargo</th>
        <th>Setor</th>
        <th>Horário</th>
        <th>Data Adm</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// ======================
// CONFIGURAÇÃO DO SISTEMA
// ======================
const CHAVE_DADOS = "sistema_funcionarios_v1_1";
const CHAVE_NEXTID = "sistema_funcionarios_v1_1_nextId";

// === Abas ===
const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => tab.addEventListener('click', () => abrirAba(tab.dataset.tab)));

function abrirAba(nomeAba) {
  tabs.forEach(t => t.classList.remove('active'));
  tabContents.forEach(c => c.classList.remove('active'));
  document.querySelector(`.tab[data-tab="${nomeAba}"]`)?.classList.add('active');
  document.getElementById(nomeAba)?.classList.add('active');
  if(nomeAba === 'inserir') inputNome.focus();
  if(nomeAba === 'consulta') filtroInput.focus();
}

// === Carregar dados ===
let registros = JSON.parse(localStorage.getItem(CHAVE_DADOS)) || [];
let proximoId = parseInt(localStorage.getItem(CHAVE_NEXTID)) || 
                (registros.length ? Math.max(...registros.map(r=>r.id)) + 1 : 1);
let editandoId = null;

// === Campos ===
const formCadastro = document.getElementById('formCadastro');
const inputId = document.getElementById('id');
const inputNome = document.getElementById('nome');
const inputCargo = document.getElementById('cargo');
const inputSetor = document.getElementById('setor');
const inputHorarioInicio = document.getElementById('horarioInicio');
const inputHorarioFim = document.getElementById('horarioFim');
const inputDataAdm = document.getElementById('dataAdm');
const btnSalvar = document.getElementById('btnSalvar');
const btnCancelar = document.getElementById('btnCancelar');
const filtroInput = document.getElementById('filtroGeral');
const btnInserirCadastro = document.getElementById('btnInserirCadastro');

// === Funções ===
function limparFormulario() {
  inputNome.value = inputCargo.value = inputSetor.value = "";
  inputHorarioInicio.value = inputHorarioFim.value = inputDataAdm.value = "";
  editandoId = null;
  btnSalvar.textContent = "Salvar";
  inputId.value = proximoId;
  inputNome.focus();
}

// === Enter muda campo ===
const formFields = Array.from(formCadastro.querySelectorAll('input:not([readonly])'));
formCadastro.addEventListener('keydown', e => {
  if(e.key === "Enter") {
    e.preventDefault();
    const idx = formFields.indexOf(e.target);
    if(idx >= 0 && idx < formFields.length - 1) formFields[idx+1].focus();
    else btnSalvar.focus();
  }
});

// === Maiúsculas automáticas ===
[inputNome, inputCargo, inputSetor].forEach(input => {
  input.addEventListener('input', () => input.value = input.value.toUpperCase());
});

// === Salvar ===
btnSalvar.addEventListener('click', () => {
  if(!inputNome.value.trim()){ alert("NOME OBRIGATÓRIO"); inputNome.focus(); return; }

  if (inputHorarioInicio.value && inputHorarioFim.value) {
    if (inputHorarioFim.value <= inputHorarioInicio.value) {
      alert("O horário de término deve ser maior que o horário de início!");
      inputHorarioFim.focus();
      return;
    }
  }

  const registro = {
    id: editandoId || proximoId,
    nome: inputNome.value.trim(),
    cargo: inputCargo.value.trim(),
    setor: inputSetor.value.trim(),
    horario: inputHorarioInicio.value + " às " + inputHorarioFim.value,
    admissao: inputDataAdm.value
  };

  if(editandoId) {
    const idx = registros.findIndex(r => r.id === editandoId);
    registros[idx] = registro;
  } else {
    registros.push(registro);
    proximoId++;
  }

  localStorage.setItem(CHAVE_DADOS, JSON.stringify(registros));
  localStorage.setItem(CHAVE_NEXTID, proximoId);
  limparFormulario();
  atualizarTabela();
  abrirAba('consulta');
});

// === Cancelar ===
btnCancelar.addEventListener('click', () => {
  limparFormulario();
  abrirAba('consulta');
});

// === Atualizar tabela ===
function atualizarTabela(filtro = "") {
  const tbody = document.querySelector("#tabelaConsulta tbody");
  tbody.innerHTML = "";

  let filtrados = registros;
  if(filtro.trim() !== "") {
    const f = filtro.toUpperCase();
    filtrados = registros.filter(r =>
      r.id.toString().includes(f) ||
      r.nome.includes(f) ||
      r.cargo.includes(f) ||
      r.setor.includes(f) ||
      r.horario.includes(f) ||
      formatarData(r.admissao).includes(f)
    );
  }

  filtrados.sort((a,b)=> a.nome.localeCompare(b.nome));

  filtrados.forEach(reg => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${reg.id}</td>
      <td>${reg.nome}</td>
      <td>${reg.cargo}</td>
      <td>${reg.setor}</td>
      <td>${reg.horario}</td>
      <td>${formatarData(reg.admissao)}</td>
      <td class="actions">
        <button class="edit" title="Editar">&#9998;</button>
        <button class="delete" title="Excluir">&#10060;</button>
      </td>`;
    tbody.appendChild(tr);

    tr.querySelector('.edit').addEventListener('click', () => {
      preencherFormulario(reg);
      abrirAba('inserir');
    });
    tr.querySelector('.delete').addEventListener('click', () => {
      if(confirm(`Excluir ${reg.nome}?`)){
        registros = registros.filter(r => r.id !== reg.id);
        localStorage.setItem(CHAVE_DADOS, JSON.stringify(registros));
        atualizarTabela(filtroInput.value);
      }
    });
  });
}

// === Editar ===
function preencherFormulario(r) {
  inputId.value = r.id;
  inputNome.value = r.nome;
  inputCargo.value = r.cargo;
  inputSetor.value = r.setor;
  const h = r.horario.split(" às ");
  inputHorarioInicio.value = h[0] || "";
  inputHorarioFim.value = h[1] || "";
  inputDataAdm.value = r.admissao;
  editandoId = r.id;
  btnSalvar.textContent = "Atualizar";
  inputNome.focus();
}

// === Formata data ===
function formatarData(data){
  if(!data) return "";
  const d = new Date(data);
  return d.toLocaleDateString("pt-BR");
}

// === Filtro ===
filtroInput.addEventListener('input', () => {
  filtroInput.value = filtroInput.value.toUpperCase();
  atualizarTabela(filtroInput.value);
});

// === Botão Inserir Cadastro ===
btnInserirCadastro.addEventListener('click', () => {
  limparFormulario();
  abrirAba('inserir');
});

// === Sair ===
document.getElementById('btnSair').addEventListener('click', () => {
  if (confirm("Deseja realmente sair e voltar ao menu principal?")) {
    window.location.href = "menu.html";
  }
});

// === Inicialização ===
limparFormulario();
atualizarTabela();
abrirAba('consulta');
</script>

<script type="module" src="firebase.js"></script>
<script type="module" src="app.js"></script>
</body>
</html>
